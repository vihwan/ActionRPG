using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.EventSystems;

public class CameraMoveController : MonoBehaviour
{

    public Transform CameraMan;
    RaycastHit hit;

    [SerializeField] private float camSpeed = 10.0f; //?????? ???????? ????
    [SerializeField] private float mouseX = 0.0f;
    [SerializeField] private float mouseY = 0.0f;
    [SerializeField] private float Wheel = -4.0f;    //?????? ?? ????
    [SerializeField] private float LayDist;          //???? ???????? ????
    private int RayCount = 0;     //?????? ???? ?????? ???? ????

    void Start()
    {
        transform.localPosition = new Vector3(0, 1.5f, Wheel); //???? ???? ??????
        LayDist = (CameraMan.position - transform.position).magnitude; //???????????? ??????
    }

    void Update()
    {
        //Cursor.lockState = CursorLockMode.Locked; //???? ??????
        LookAround(); //?????? ???? ??????
        Zoom();       //?? ??????
        cameraRay();  // ?????????? ?? ???????? ??????????

    }

    #region LookAround
    void LookAround()
    {


        mouseX += Input.GetAxis("Mouse X");
        mouseY += Input.GetAxis("Mouse Y") * -1;

        //???????? ????
        if (mouseY > 6)
            mouseY = 6;
        if (mouseY < -3.0f)
            mouseY = -3.0f;

        CameraMan.rotation = Quaternion.Euler(
            new Vector3(
                CameraMan.rotation.x + mouseY,
                CameraMan.rotation.y + mouseX,
                0) * camSpeed);

    }
    #endregion

    #region Zoom
    void Zoom()
    {
        if (Input.GetAxis("Mouse ScrollWheel") != 0 && RayCount == 0) //?????? ???????? ????
        {
            Wheel += Input.GetAxis("Mouse ScrollWheel") * 5.0f;

            //?? ????
            if (Wheel >= -1)
                Wheel = -1;
            if (Wheel <= -7)
                Wheel = -7;

            transform.localPosition = new Vector3(0, 1.5f, Wheel); // ???? ?????? ???????? ????
            LayDist = (CameraMan.position - transform.position).magnitude; //?????????? ???? ???? ???????? ????
        }

    }
    #endregion

    #region CameraRay
    void cameraRay()
    {
        int layerMask = 1 << LayerMask.NameToLayer("ground"); //?????? ?????? ??????????

        Vector3 Axis = CameraMan.position + Vector3.up; // ?????????? ?????? ?????????????? ????
        Physics.Raycast(Axis, (Axis - transform.position) * -1, out hit, LayDist, layerMask); // ???? ???? 
        //Debug.DrawRay(Axis, (Axis - transform.position) * -1);

        if (hit.point != Vector3.zero) //??????????
        {
            float dist = (hit.point - Axis).magnitude * 0.8f;
            transform.position = Vector3.Lerp(transform.position, Axis + ((Axis - transform.position) * -1).normalized * dist, 0.1f);
            RayCount = 1; //?? ???? ????
        }
        else // ???? ????????
        {
            transform.localPosition = Vector3.Lerp(transform.localPosition, new Vector3(0, 1.5f, Wheel), 0.1f);
            RayCount = 0;
        }
    }
    #endregion

}